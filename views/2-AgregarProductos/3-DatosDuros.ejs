<% rubro = dataEntry.rubroAPI=="movie" ? "Película" : "Colección" %>
<h1 class="titulo" id="titulo">Agregá una <%= rubro %> a nuestra Base de Datos</h1>
<form action="<%= link %>" method="POST" enctype = "multipart/form-data" id="dataEntry" class="flex-col" >
	<section id="titulos">
		<h2>Paso 3 de 4: Completá los Datos Pendientes</h2>
		<div class="flex-col" id="links">
			<p>Si necesitás consultar algún dato</p>
			<nav class="flex-row">
				<% tmdb = dataEntry.fuente!="TMDB" && dataEntry.nombre_original ? "search?language=es&query="+dataEntry.nombre_original : "" %>
				<% fa = dataEntry.fuente!="FA" && dataEntry.nombre_original ? "search.php?stext="+dataEntry.nombre_original : "" %>
				<% imdb = (dataEntry.peli_imdb_id) ? ("title/"+dataEntry.peli_imdb_id+"/technical") : dataEntry.nombre_original ? "find?q="+dataEntry.nombre_original : "" %>
				<% if (tmdb != "") { %>
					<a class="logos" href="https://www.themoviedb.org/<%= tmdb %>" target="_blank"><img src="/imagenes/0-Base/LogoTMDB.jpg" alt="TMDB"></a>
				<% } %>
				<% if (fa) { %>
					<a class="logos" href="https://www.filmaffinity.com/es/<%= fa %>" target="_blank"><img src="/imagenes/0-Base/LogoFA.jpg" alt="FA"></a>
				<% } %>
				<a class="logos" href="https://www.imdb.com/<%= imdb %>" target="_blank"><img src="/imagenes/0-Base/LogoIMDB.jpg" alt="IMDB"></a>
			</nav>
		</div>
	</section>
	<!-- Datos -->
	<section id="cuerpo">
		<!--Primera columna-->
		<div class="flex-col">
			<!-- Película IM: ¿Pertenece a una colección? -->
			<% if (dataEntry.rubroAPI=="movie" && dataEntry.fuente=="IM") { %>
				<section style="order: 0; margin-top: 0; margin-bottom: 3px;" class="label-input flex-row ">
					<label>¿Pertenece a una colección?</label>
					<!-- Data-entry y Errores -->
					<div class="input-error">
						<select name="en_coleccion" class="input angosto">
							<option style="font-style: italic" value="" selected class="ocultar">Elegí</option>
							<option value="NO">NO</option>
							<option value="SI">SI</option>
						</select>
						<i class="fas fa-times-circle<%- !errores.en_coleccion ? ' ocultar' : '' %>">
							<span class="mensajeError"><%= errores.en_coleccion %></span>
						</i>
					</div>
				</section>
			<% } %> 
			<!-- Campos varios -->
			<% for (let i=0; i < datos.length; i++) { %>
				<%- include("31-DD-Input", {i}) %> 
			<% } %> 
			<!-- País -->
			<section style="order: 4;" class="label-input flex-row">
				<label>País de origen</label>
				<div class="input-error">
					<% if (pais) { %>
						<input type="text" class="input" value="<%= pais %>" disabled>
						<%- include("32-DD-Mensajes") %>
					<% } else { %>
						<select name="pais_id" class="input">
							<option value="" selected class="ocultar">Elejí un país</option>
							<% continentes = ["América", "Europa", "Africa", "Asia", "Oceanía"] %> 
							<% for (continente of continentes) { %>
								<optgroup label="<%= continente %>">
									<% for (n of paises.filter(m => m.continente == continente)) { %>
										<option value="<%= n.id %>"><%= n.nombre %></option>
									<% } %>	
								</optgroup>
							<% } %> 
						</select>
					<% } %>
					<i class="fas fa-times-circle<%- !errores.pais_id ? ' ocultar' : '' %>">
						<span class="mensajeError"><%= errores.pais_id %></span>
					</i>
				</div>
			</section>
			<!--Sinopsis-->
			<section style="order: 9;" class="label-input flex-row">
				<label>Sinopsis</label>
				<div class="input-error">
					<textarea 
						name="sinopsis" rows="1" class="input" placeholder="Ingresa aquí la sinopsis"
						<% if (dataEntry.sinopsis && !errores.sinopsis) { %>disabled<% } %>
					><%= dataEntry.sinopsis %></textarea>
					<%- (dataEntry.sinopsis && !errores.sinopsis) ? include("32-DD-Mensajes") : "" %>
					<i class="fas fa-times-circle<%- !errores.sinopsis ? ' ocultar' : '' %>">
						<span class="mensajeError"><%= errores.sinopsis %></span>
					</i>
				</div>
			</section>
		</div>
		<!--Columna intermedia-->
		<div id="columnaMedio">
		</div>
		<!--Segunda columna-->
		<div id="imagenPeli" class="form-grupo input-error">
			<!-- Si viene desde TMDB -->
			<% if (dataEntry && dataEntry.fuente!="TMDB") { %><label for="imagen" id="preview"></label><% } %>
			<% if (dataEntry.avatar && dataEntry.fuente=="TMDB") { %><img id="imgTMDB" src="<%= dataEntry.avatar %>" alt="afiche"><% } %>
			<!-- Si viene desde FA -->
			<% if (dataEntry.avatar && dataEntry.fuente=="FA") { %>
				<button type="button">Hacé <em>click</em> acá y luego<br>pegá con <em>Ctrl + V</em></button>
				<p id="url" class="ocultar"><%= dataEntry.avatar %></p>
			<% } %>
			<!-- Si viene desde Ingreso Manual -->
			<% if (!dataEntry.avatar || dataEntry.fuente=="IM") { %><button type="button">Elegí una imagen de<br>la web y pegá el URL</button><% } %>
			<!-- Rutina para todos los casos -->
			<input name="avatar" type="file" accept="image/*" id="imagen" class="input ocultar">
			<i class="fas fa-times-circle <%- dataEntry.avatar && dataEntry.fuente=="TMDB" ? 'ocultar' : '' %>">
				<span class="mensajeError"><%= errores.avatar %></span>
			</i>
		</div>	
	</section>
	<!-- Flechas y Botón -->
	<section id="flechas" class="flex-row space-between">
		<% retroceso = dataEntry.fuente != "FA" ? "desambiguar" : "copiar-fa" %>
		<a href="/agregar/productos/<%= retroceso %>"><i class="fas fa-arrow-alt-circle-left"></i></a>
		<button type="submit">Avanzar</button>
		<% if (false) { %>
			<a href="#"><i class="fas fa-arrow-alt-circle-right"></i></a>
		<% } else { %>
			<i class="fas fa-arrow-alt-circle-right flechaSinLink"></i>
		<% } %>
	</section>
</form>
